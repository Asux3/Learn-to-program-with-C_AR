\chapter{كتابة نصوص باستعمال \textenglish{SDL\_ttf}}

يمكنني التكهّن بأن معظم القرّاء قد طرح هذا السؤال من قبل : "و لكن، ألا توجد أي دالة لكي تكتب نصاً على نافذة
\textenglish{SDL} ؟"
حان الوقت لأجيبك : الجواب هو لا.

رغم ذلك، توجد طرق لفعل هذا. يمكننا فقط \dots وضع صور للحروف بجانب بعضها البعض على الشاشة. هذا الأمر يعمل لكنّه ليس عمليا.

لحسن الحظ، يوجد ماهو أبسط : يمكننا استعمال المكتبة
\textenglish{SDL\_ttf}.
إنها مكتبة تتم إضافتها إلى الـ\textenglish{SDL}
تماماً مثل الـ\textenglish{SDL\_image}.
دورها هو إنشاء مساحة
\InlineCode{SDL\_Surface}
إنطلاقا من النص الذي نبعثه لها.

\section{تسطيب \textenglish{SDL\_ttf}}

يجب أن تعرف أنه، مثل
\textenglish{SDL\_image}، \textenglish{SDL\_ttf}
هي مكتبة تحتاج إلى أن تكون المكتبة
\textenglish{SDL}
مثبّتة من قبل. حسناً : إذا كنت إلى حدّ الآن لم تتمكّن من تسطيب المكتبة
\textenglish{SDL}
فهذا أمر شنيع و لهذا فسأعتبر أنك قمت بذلك !

تماما مثل 
\textenglish{SDL\_image}،
فإن المكتبة 
\textenglish{SDL\_ttf}
هي واحدة من المكتبات المُرتبطة بالـ\textenglish{SDL}
الأكثر شعبية (أي أنه يتم تحميلها بكثرة). كما ستُلاحظ، هذه المكتبة مُبرمجة بشكل جيد. ما إن تجيد استعمالها لن يمكنك أن تتوقّف عن ذلك !

\subsection{كيف تعمل \textenglish{SDL\_ttf} ؟}

\textenglish{SDL\_ttf}
لا تقوم بإظهار صور 
\textenglish{bitmap}
لتولّد نصا في مساحات. في الحقيقة، هي طريقة ثقيلة لفعلها و لن يتاح لنا استعمال سوى خط واحد. \\
في الواقع، تستدعي المكتبة
\textenglish{SDL\_ttf}
مكتبةَ أخرى : 
\textenglish{FreeType}.
هي مكتبة قادرة على قراءة ملفات خطوط بصيغة
\InlineCode{.ttf}
لتُخرج منها صورة. تقوم
\textenglish{SDL\_ttf}
باسترجاع هذه الصورة و تحوّلها للـ\textenglish{SDL}
و ذلك بإنشاء مساحة
\InlineCode{SDL\_Surface}.

و بهذا فإن
\textenglish{SDL\_ttf}
تحتاج المكتبة
\textenglish{FreeType}
لكي تشتغل، و إلا فلن تكون قادرة على قراءة ملفات الخطوط
\InlineCode{.ttf}.

إذا كنت تعمل بـ\textbf{\textenglish{Windows}}
و تستعمل، مثلما أفعل، النسخة المُترجمَة للمكتبة، لن تحتاج إلى تحميل أي شيء لأن
\textenglish{FreeType}
مضمّنة من قبل في المكتبة الحيّة
\InlineCode{SDL\_ttf.dll}
و لهذا فليس عليك القيام بأي شيء.

إذا كنت تعمل بالـ\textbf{\textenglish{GNU/Linux}}
أو
\textbf{\textenglish{Mac OS X}}
فمن اللازم أن تعيد ترجمة المكتبة، فتلزمك
\textenglish{FreeType}
لتتم الترجمة. إذهب إذن إلى صفحة تحميل
\textenglish{FreeType} :

\url{http://www.freetype.org/download.html#stable}

لنحمّل الملفات الخاصة بالمطورين.

\subsection{تثبيت \textenglish{SDL\_ttf}}

إذهب إلى  صفحة تحميل 
\textenglish{SDL\_ttf} :

\url{http://www.libsdl.org/projects/SDL_ttf/}

هنا، اختر الملف اللازم من القسم
"\textit{\textenglish{Binary}}".

\begin{information}
في
\textenglish{Windows}،
 لاحظ أنه لا يوجد سوى ملفان بصيغة 
\InlineCode{.zip}
يحملان في نهاية اسميهما اللاحقتين
\InlineCode{win32}
و
\InlineCode{VC6}.
الأولى 
(\InlineCode{win32})
تحتوي الـ\textenglish{DLL}
التي تحتاج إلى تقديمها مع الملف التنفيذي. يجب عليك أيضاً وضع هذه الـ\textenglish{DLL}
في مجلّد المشروع لتستطيع تجريب البرنامج، طبعا.

الثانية 
(\InlineCode{VC6})
تحتوي الملفات 
\InlineCode{.h}
و الملفات
\InlineCode{.lib}
التي تحتاجها للبرمجة. يمكننا أن نفكّر من خلال الاسم أن هذه الملفّات تخص
\textenglish{Visual C++}
فقط، لكن في الحقيقة، و بشكل خاص، الملف
\InlineCode{.lib}
يعمل أيضاً مع
\textenglish{mingw32}،
سيشتغل إذن في الـ\textenglish{Code::Blocks}.
\end{information}

الملف
\InlineCode{.zip}
يحتوي كالعادة مجلد
\InlineCode{include}
و مجلد
\InlineCode{lib}.
قم بوضع محتوى المجلد
\InlineCode{include}
في المسار
\InlineCode{mingw32/include/SDL}،
و محتوى المجلد
\InlineCode{lib}
في المسار 
\InlineCode{mingw32/lib}.

\begin{warning}
 يجدر بك نسخ الملف
\InlineCode{SDL\_ttf.h}
في المجلد
\InlineCode{mingw32/include/SDL}
و ليس في المجلد 
\InlineCode{mingw32/include}
فقط. احذر الخطأ !
\end{warning}

\subsection{تخصيص مشروع من أجل الـ\textenglish{SDL\_ttf}}

بقيت لنا مرحلة واحدة أخيرة : تخصيص المشروع لكي يكون قادراً على استعمال
\textenglish{SDL\_ttf}
بشكل جيد. يجب أن يتم التعديل على خصائص محرّر الروابط لكي يُترجم البرنامج بشكل جيد و ذلك باستعمال
\textenglish{SDL\_ttf}.

لقد تعلّمت من قبل هذه العملية بالنسبة لـ\textenglish{SDL\_image}،
و لهذا سأسرع قليلاً. \\
بما أنني أعمل في الـ\textenglish{Code::Blocks}
سأعطيك العملية الخاصة بهذه البيئة التطويرية. بالنسبة لباقي البيئات، فالطريقة لا تختلف كثيراً عن هذه :

\begin{itemize}
	\item توجّه نحو القائمة
	\InlineCode{Project} / \InlineCode{Build Options}.
	\item في القسم
	\InlineCode{Linker}
	أنقر على الزر الصغير
	\InlineCode{Add}.
	\item أشر إلى المسار الذي يوجد به الملف
	\InlineCode{SDL\_ttf.lib}
	(بالنسبة لي هو في\\
	\InlineCode{C:\textbackslash Program Files\textbackslash CodeBlocks\textbackslash mingw32\textbackslash lib}).
	\item ستظهر لك هذه الرسالة :
	"\textenglish{Keep this as a relative path ?}"
	لا يهمّ ما تختاره لأن الأمر سيشتغل في كلتا الحالتين. أنصحك أن تجيب بالسلب لأن المشروع لن يشتغل لو وضعته في مسار آخر غير المتواجد به لو أنك أجبت بالإيجاب.
	\item وافق على التغييرات بالنقر على 
	\InlineCode{OK}.
\end{itemize}

\begin{question}
ألا نحتاج إلى ربط المكتبة
\textenglish{FreeType}
أيضاً ؟
\end{question}

كلا، مثلما قلتُ فـ\textenglish{FreeType}
مضمّنة في الـ\textenglish{DLL}
الخاصة بـ\textenglish{SDL\_ttf}.
لهذا فلن يكون عليك الإهتمام بها، لأن
\textenglish{SDL\_ttf}
تفعل ذلك الآن.
\subsection{الملفات التوثيقية}

و الآن بما أنك أصبحت مبرمجاً محنّكاً تقريباً، يجدر بك أن تطرح التساؤل التالي : "لكن أين هو التوثيق ؟" إن لم تطرح هذا السؤال فهذا يعني أنّك لازلت لم تصبح بعد مبرمجاً محنّكاً.

يوجد بالطبع دروس تفصّل في كيفية عمل المكتبات، مثل هذا الكتاب، و لكن :

\begin{itemize}
	\item لن أستطيع أن أضع لك فصلاً حول كل المكتبات الموجودة (حتى لو أمضيت حياتي كلّها في ذلك، لن يكفيني الوقت !). و لهذا يجب عاجلاً أم آجلا قراءة التوثيق و يجدر بك أن تتعوّد على ذلك من الآن !
	\item من جهة أخرى، في غالب الأحيان تكون المكتبة معقّدة نوعاً ما و تحتوي كثيراً من الدوال. لن أتمكن من تقديم كلّ هذه الدوال في هذا الفصل لأنه سيكون بذلك طويلاً جداً !
\end{itemize}

من الواضح جداً أن التوثيق يكون كاملا و يلمّ بكل حفايا المكتبة، و لهذا أفضّل أن أعطيك من الآن رابط صفحة التوثيق الخاصة بـ\textenglish{SDL\_ttf} :

\url{http://sdl.beuc.net/sdl.wiki/SDL_ttf}

التوثيق متوفّر بصيغ مختلفة : 
\textenglish{HTML}
على الشبكة، 
\textenglish{HTML}
مضغوطة،
\textenglish{PDF}،
إلخ. خذ النسخة التي تناسبك.

ستجد بأن
\textenglish{SDL\_ttf}
مكتبة بسيطة جداً : يوجد بها قليل من الدوال (حوالي 40 - 50، نعم إنها قليلة !). يجدر بهذا أن تكون إشارة (للمبرمجين المحنّكين من ضمن القرّاء) إلى أن هذه المكتبة سهلة و ستستطيع التعامل معها سريعاً.

هيا، حان الوقت لنتعلّم كيف نستخدم
\textenglish{SDL\_ttf}
الآن !

\section{تحميل \textenglish{SDL\_ttf}}

\subsection{التضمين}

قبل كلّ شيء، يجب تضمين الملف الرأسي التالي قبل كلّ استعمال لهذه المكتبة :

\begin{Csource}
#include <SDL/SDL_ttf.h>
\end{Csource}

إذا صادفت أخطاء ترجمة الآن، تأكد بأنك وضعت الملف
\InlineCode{SDL\_ttf.h}
في المجلّد
\InlineCode{mingw32/include/SDL}
و ليس في 
\InlineCode{mingw32/include}
فقط.

\subsection{تشغيل \textenglish{SDL\_ttf}}

تماما مثل الـ\textenglish{SDL}،
تحتاج
\textenglish{SDL\_ttf}
أن ُتشغّل في بداية الشفرة وتُوقّف في نهايتها.\\
توجد دالتان تشبهان كثيراً الدالتين الخاصتين بالـ\textenglish{SDL} :

\begin{itemize}
	\item \InlineCode{TTF\_Init} :
	تقوم ببدء تشغيل
	\textenglish{SDL\_ttf}.
	\item \InlineCode{TTF\_Quit} :
	توقّف
	\textenglish{SDL\_ttf}.
\end{itemize}

\begin{information}
ليس واجباً أن يتم بدء تشغيل
\textenglish{SDL}
قبل
\textenglish{SDL\_ttf}.
\end{information}

 لكي تقوم ببدء تشغيل
\textenglish{SDL\_ttf}
(نقول أيضاً تهيئة)، يجب أن نستدعي الدالة
\InlineCode{TTF\_Init}.
هذه الأخيرة لا تحتاج إلى أن تستقبل أي معامل و هي تقوم بإرجاع القيمة
$-1$
إن حدث أي خطأ.

يمكنك البدء في تشغيل
\textenglish{SDL\_ttf}
ببساطة كالتالي :

\begin{Csource}
TTF_Init();
\end{Csource}

إذا أردت أن تتأكد ما إن كان قد حدث خطأ أم لا، جرّب الشفرة التالية :

\begin{Csource}
if(TTF_Init() == -1)
{
	fprintf(stderr, "Error initializing TTF_Init : %s\n", TTF_GetError());
	exit(EXIT_FAILURE);
}
\end{Csource}
إذا كان هناك خطأ في تشغيل
\textenglish{SDL\_ttf}،
سيتم إنشاء ملف
\InlineCode{stderr.txt}
(في
\textenglish{Windows}
على الأقل) يحتوي على رسالة تشرح الخطأ.\\
للذين يطرحون السؤال : الدالة
\InlineCode{TTF\_GetError}
تقوم بإرجاع آخر رسالة خطأ للـ\textenglish{SDL\_ttf}،
و لهذا استعملته في الـ\InlineCode{fprintf}.

\subsection{إيقاف \textenglish{SDL\_ttf}}

 لنوقّف المكتبة، نستدعي الدالة
\InlineCode{TTF\_Quit}.
هي أيضاً لا تحتاج أي معامل. يمكنك استدعاؤها قبل أو بعد
\InlineCode{SDL\_Quit}
هذا لا يهم  :

\begin{Csource}
TTF_Quit();
\end{Csource}

\subsection{تحميل خط}

حسناً كان كلّ شيء جيداً و غير معقّدٍ، لكننا لم نستمتع بعد. لننتقل إلى الأهمّ إذا أردت ذلك : و الآن بما أنه تم تحميل 
\textenglish{SDL\_ttf}،
يجب علينا أن نقوم بتحميل خط ما. ما إن يتم هذا الشيء، يمكننا أخيراً كتابة النص !

هنا أيضاً، توجد دالتان :
\begin{itemize}
	\item \InlineCode{TTF\_OpenFont} :
	تفتح ملف خط
	(\InlineCode{.ttf}).
	\item \InlineCode{TTF\_CloseFont} : 
	تغلق الملف المفتوح.
\end{itemize}

يجدر بالدالة
\InlineCode{TTF\_OpenFont}
أن تخزّن النتيجة في متغير من نوع
\InlineCode{TTF\_Font}.
لهذا يجب عليك إنشاء مؤشّر من نوع
\InlineCode{TTF\_Font}
كالتالي :

\begin{Csource}
TTF_Font *font = NULL;
\end{Csource}

يحتوي المؤشّر
\InlineCode{font}
إذا على معلومات خاصة بالخط المفتوح.

تأخذ الدالة 
\InlineCode{TTF\_OpenFont}
معاملين :

\begin{itemize}
	\item اسم ملف الخط (بصيغة
	\InlineCode{.ttf})
	الذي نريد فتحه. الأمثل هو وضع ملف الخط في مجلّد المشروع. مثال عن ملف :
	\InlineCode{arial.ttf}
	(من أجل الخط
	\textenglish{Arial}).
	\item حجم الخط الذي نريد استعماله. يمكنك مثلا استعمال حجم 22.
	
	إنها نفس الحجوم التي تستعملها في برامج معالجة النصوص مثل
	\textenglish{Word}.
\end{itemize}

لم يتبقّ لنا سوى إيجاد الخطوط ذات الصيغة
\InlineCode{.ttf}.
أنت تملك أصلاً العديد منها على حاسوبك، لكن يمكنك تنزيلها من الأنترنت كما سنرى الآن.

\subsubsection{على حاسوبك}

لديك أصلا خطوط على حاسوبك !\\
إن كنت تعمل بالويندوز، ستجد الكثير من هذه الملفات في المجلّد
\InlineCode{C:\textbackslash Windows\textbackslash Fonts}.\\
ليس عليك سوى نسخ الملف الخاص بالخط الذي يعجبك و لصقه في مجلّد المشروع. 

إذا كان اسم الملف يحتوي على حروف "غريبة" كالفراغات، الحروف ذات العلامات الصوتية 
(\textenglish{accents})
أو حتى الحروف الكبيرة، أنصحك بإعادة تسمية هذا الملف. و لكي نكون متيقنين من عدم وجود أيّ مشكل، لا تستعمل سوى الأحرف الصغيرة و تجنّب الفراغات.

\begin{itemize}
	\item مثال عن اسم خاطئ : 
	\InlineCode{TIMES NEW ROMAN.TTF}.
	\item مثال عن اسم صحيح :
	\InlineCode{times.ttf}.
\end{itemize}

\subsubsection{على الأنترنت}

الخيار الآخر : احصل على خطّ من الأنترنت. ستجد الكثير من المواقع التي تقترح خطوطا مجانية و أصلية للتنزيل.

أنصحك شخصيا بزيارة الموقع
\href{http://www.dafont.com/}{\textenglish{dafont.com}}
لأنّه مصنّف بشكل جيّد و محتواه منظّم و منوّع.

لاحظ الصور التالية التي ستعطيك فكرة عن الخطوط التي ستجدها هناك بسهولة :

\Picture{Chapter_III-7_Font1}
\Picture{Chapter_III-7_Font2}
\Picture{Chapter_III-7_Font3}

\subsubsection{تحميل الخط}

 أقترح عليك استعمال الخط 
\textenglish{Angelina} (\url{http://www.dafont.com/angelina.font})
 لبقية الأمثلة.

فلنفتح الخط كالتالي  :

\begin{Csource}
font = TTF_OpenFont("angelina.ttf", 65);
\end{Csource}

الخط المستعمل سيكون
\InlineCode{angelina.ttf}.
لقد قمت وضع هذا الخط في مجلّد المشروع كما قمت بإعادة تسميته لكي يكون كلّه بحروف صغيرة.\\
سيكون للخط الحجم 65. ستبدو الكتابة كبيرة لكنه خطّ خاص يستلزم ذلك لكي يظهر بشكل جيد.

الأمر المهم هو أن
\InlineCode{TTF\_OpenFont}
تخزّن النتيجة في المتغير
\InlineCode{font}،
ستعيد استعمال هذا المتغير الآن بكتابة نص. فهي تسمح بالإشارة إلى الخط الذي نريد أن نستعمله لكي نكتب النص.

\begin{information}
لا تحتاج إلى فتح الخط في كلّ مرة تريد فيها الكتابة به : افتحه مرّة واحدة في بداية البرنامج و أغلقه في نهايته.
\end{information}

\subsubsection{غلق الخط}

يجب التفكير في غلق كل خط قمنا بفتحه قبل استدعاء
\InlineCode{TTF\_Quit}.
في حالتي، هذا ما تكون عليه الشفرة :

\begin{Csource}
TTF_CloseFont(font); // Must be before TTF_Quit();
TTF_Quit();
\end{Csource}

هكذا يكون العمل !
